

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>0. 실습 프로젝트 개요 &#8212; 기업가치분석 2023</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=927b94d3fcb96560df09" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=927b94d3fcb96560df09" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09" />
  <script src="_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=927b94d3fcb96560df09"></script>

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'exec_2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="0. 데이터 사이언스 툴킷 소개" href="exec_1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Python 기업가치분석 2023년
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="exec_1.html">0. 데이터 사이언스 툴킷 소개</a></li>



<li class="toctree-l1 current active"><a class="current reference internal" href="#">0. 실습 프로젝트 개요</a></li>









</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fexec_2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/exec_2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>0. 실습 프로젝트 개요</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">0. 실습 프로젝트 개요</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dart-api-key">1. 오픈DART API Key</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#db">2. DB 입출력 함수 정의</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#company">3. 기업개황 테이블(COMPANY)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#report">4. 보고서 접수번호 테이블(REPORT)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiz-3">[Quiz 3]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fs">5. 감사보고서 파싱하여 저장(FS)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#anls">6. 재무분석 수행(ANLS)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beneish-m-score-1999-detect-financial-fraud">재무제표 신뢰도(Beneish M-score, 1999) -&gt; detect financial fraud</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#financial-ratios">Financial Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#free-cash-flow">Free Cash Flow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#altman-z-score-detect-corporate-failure">부도와의 거리(Altman z-score) -&gt; detect corporate failure</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf">7. 기업가치평가 시뮬레이션(DCF)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiz-4">[Quiz 4]</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>[주의사항] <span style='color:red'>본 실습 코드들은 교육용으로 제공한 것입니다. 강사의 허락없는 상업적/비상업적 사용을 일체 금지합니다.</span></p>
<section id="id1">
<h1>0. 실습 프로젝트 개요<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h1>
<p>우리나라 중소/중견 4개 샘플기업의 재무제표를 금감원 오픈다트로부터 다운로드 받아 재무분석과 DCF 기업가치를 계산해보는 프로젝트</p>
<p>참고: <a class="reference external" href="http://ohmybike.pythonanywhere.com">온M&amp;A-기업분석 금융공학 플랫폼</a></p>
<ul class="simple">
<li><p>오픈다트(<a class="reference external" href="https://opendart.fss.or.kr">https://opendart.fss.or.kr</a>) 가입후 개인회원용 API 인증키 발급 필요</p></li>
<li><p>파이썬 내장 DB인 SQLite3 데이터베이스 조회 위해 ‘DB Browser for SQLite’ (<a class="reference external" href="https://sqlitebrowser.org">https://sqlitebrowser.org</a>) 설치 필요</p></li>
</ul>
<p><img alt="image.png" src="attachment:ca4c16e0-ab22-48fd-8972-ca7020bce43c.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 오픈다트 소개 동영상</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;Loe4rXKehyU&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/Loe4rXKehyU"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="dart-api-key">
<h1>1. 오픈DART API Key<a class="headerlink" href="#dart-api-key" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DB_NAME</span> <span class="o">=</span> <span class="s1">&#39;dart.sqlite3&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 금감원 오픈DART에서 받은 자신의 api key를 입력</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;45688185cb834c3c13d22ba42a1ba654ad30e628&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">corp</span> <span class="o">=</span> <span class="s1">&#39;00108269&#39;</span> <span class="c1"># 샘플기업(농심켈로그)</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://opendart.fss.or.kr/api/company.xml&#39;</span><span class="p">,</span> \
                    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;crtfc_key&#39;</span><span class="p">:</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;corp_code&#39;</span><span class="p">:</span><span class="n">corp</span><span class="p">})</span>

<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml-xml&#39;</span><span class="p">)</span>
<span class="n">status</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>

<span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;000&#39;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;  api_Key is NOT working )-:&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="s1">&#39;  api_key is working ^^&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FeatureNotFound</span><span class="g g-Whitespace">                           </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">9</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">corp</span> <span class="o">=</span> <span class="s1">&#39;00108269&#39;</span> <span class="c1"># 샘플기업(농심켈로그)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://opendart.fss.or.kr/api/company.xml&#39;</span><span class="p">,</span> \
<span class="g g-Whitespace">      </span><span class="mi">7</span>                     <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;crtfc_key&#39;</span><span class="p">:</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;corp_code&#39;</span><span class="p">:</span><span class="n">corp</span><span class="p">})</span>
<span class="ne">----&gt; </span><span class="mi">9</span> <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml-xml&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="n">status</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s1">&#39;000&#39;</span><span class="p">:</span>

<span class="nn">File ~/.local/share/virtualenvs/jupyterbook-FP8BpiMX/lib/python3.8/site-packages/bs4/__init__.py:250,</span> in <span class="ni">BeautifulSoup.__init__</span><span class="nt">(self, markup, features, builder, parse_only, from_encoding, exclude_encodings, element_classes, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">248</span>     <span class="n">builder_class</span> <span class="o">=</span> <span class="n">builder_registry</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="o">*</span><span class="n">features</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span>     <span class="k">if</span> <span class="n">builder_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">250</span>         <span class="k">raise</span> <span class="n">FeatureNotFound</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">251</span>             <span class="s2">&quot;Couldn&#39;t find a tree builder with the features you &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>             <span class="s2">&quot;requested: </span><span class="si">%s</span><span class="s2">. Do you need to install a parser library?&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>             <span class="o">%</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span> <span class="c1"># At this point either we have a TreeBuilder instance in</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span> <span class="c1"># builder, or we have a builder_class that we can instantiate</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span> <span class="c1"># with the remaining **kwargs.</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span> <span class="k">if</span> <span class="n">builder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">FeatureNotFound</span>: Couldn&#39;t find a tree builder with the features you requested: lxml-xml. Do you need to install a parser library?
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">requests</span> <span class="kn">import</span> <span class="n">get</span>

<span class="n">ip</span> <span class="o">=</span> <span class="n">get</span><span class="p">(</span><span class="s2">&quot;https://api64.ipify.org&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;My public IP address : &quot;</span><span class="p">,</span> <span class="n">ip</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>My public IP address :  180.233.193.72
</pre></div>
</div>
</div>
</div>
</section>
<section id="db">
<h1>2. DB 입출력 함수 정의<a class="headerlink" href="#db" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">select_query</span><span class="p">(</span><span class="n">sql</span><span class="p">):</span>    
    <span class="kn">import</span> <span class="nn">sqlite3</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    
    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>            
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
        
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">save_to_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">table</span><span class="p">):</span>    
   
    <span class="kn">import</span> <span class="nn">sqlite3</span><span class="p">;</span>

    <span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">DB_NAME</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index_label</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="company">
<h1>3. 기업개황 테이블(COMPANY)<a class="headerlink" href="#company" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 농심켈로그(00108269),면사랑(00301477),아성다이소(00411835),토요코인코리아(00585583)</span>
<span class="n">KELLOGG</span> <span class="o">=</span> <span class="s1">&#39;00108269&#39;</span> <span class="c1"># 제조업</span>
<span class="n">NOODLE</span> <span class="o">=</span> <span class="s1">&#39;00301477&#39;</span> <span class="c1"># 제조업</span>
<span class="n">DAISO</span> <span class="o">=</span> <span class="s1">&#39;00411835&#39;</span> <span class="c1"># 도소매업</span>
<span class="n">TOYOKO</span> <span class="o">=</span> <span class="s1">&#39;00585583&#39;</span> <span class="c1"># 숙박업</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">target_name</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;00108269&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;KELLOGG&#39;</span>
    <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;00301477&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;NOODLE&#39;</span>
    <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="s1">&#39;00411835&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;DAISO&#39;</span>
    <span class="k">elif</span> <span class="n">code</span>  <span class="o">==</span> <span class="s1">&#39;00585583&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;TOYOKO&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### COMPANY 테이블 생성</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="c1"># import random</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;corp_code&quot;</span><span class="p">,</span> <span class="s2">&quot;corp_name&quot;</span><span class="p">,</span> <span class="s2">&quot;corp_name_eng&quot;</span><span class="p">,</span> <span class="s2">&quot;stock_name&quot;</span><span class="p">,</span> <span class="s2">&quot;stock_code&quot;</span><span class="p">,</span> <span class="s2">&quot;ceo_nm&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;corp_cls&quot;</span><span class="p">,</span> <span class="s2">&quot;jurir_no&quot;</span><span class="p">,</span> <span class="s2">&quot;bizr_no&quot;</span><span class="p">,</span> <span class="s2">&quot;adres&quot;</span><span class="p">,</span> <span class="s2">&quot;hm_url&quot;</span><span class="p">,</span><span class="s2">&quot;ir_url&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;phn_no&quot;</span><span class="p">,</span> <span class="s2">&quot;fax_no&quot;</span><span class="p">,</span> <span class="s2">&quot;induty_code&quot;</span><span class="p">,</span> <span class="s2">&quot;est_dt&quot;</span><span class="p">,</span> <span class="s2">&quot;acc_mt&quot;</span><span class="p">]</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">corps</span> <span class="o">=</span> <span class="p">[</span><span class="n">KELLOGG</span><span class="p">,</span> <span class="n">NOODLE</span><span class="p">,</span> <span class="n">DAISO</span><span class="p">,</span> <span class="n">TOYOKO</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corps</span><span class="p">):</span>    
    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://opendart.fss.or.kr/api/company.xml&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;crtfc_key&#39;</span><span class="p">:</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;corp_code&#39;</span><span class="p">:</span><span class="n">corp</span><span class="p">})</span>
              
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml-xml&#39;</span><span class="p">)</span>
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[:]:</span>         
        <span class="k">if</span> <span class="n">soup</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>            
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>    
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>   

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">save_to_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;COMPANY&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="attachment:e17bd864-0a0c-4b1d-a12c-aa1919616c93.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 다트편집기 소개 동영상</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;Zt0gIglxbQM&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/Zt0gIglxbQM"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="report">
<h1>4. 보고서 접수번호 테이블(REPORT)<a class="headerlink" href="#report" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">### 비상장기업 감사보고서 접수번호 얻는 합수</span>
<span class="k">def</span> <span class="nf">get_rcept_no</span><span class="p">(</span><span class="n">corp_code</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    
    <span class="n">BEGIN</span> <span class="o">=</span> <span class="s1">&#39;20140101&#39;</span>
    <span class="n">END</span>   <span class="o">=</span> <span class="s1">&#39;20231231&#39;</span>
    
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://opendart.fss.or.kr/api/list.xml&#39;</span><span class="p">,</span> 
                        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;crtfc_key&#39;</span><span class="p">:</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;corp_code&#39;</span><span class="p">:</span><span class="n">corp_code</span><span class="p">,</span> <span class="s1">&#39;pblntf_detail_ty&#39;</span><span class="p">:</span><span class="s1">&#39;F001&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;bgn_de&#39;</span><span class="p">:</span><span class="n">BEGIN</span><span class="p">,</span> <span class="s1">&#39;end_de&#39;</span><span class="p">:</span><span class="n">END</span><span class="p">})</span> <span class="c1"># F001: 감사보고서       </span>
    
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;lxml-xml&#39;</span><span class="p">)</span>             
   
    <span class="n">tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">)</span>    
    
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corp_cls&#39;</span><span class="p">,</span> <span class="s1">&#39;rcept_no&#39;</span><span class="p">,</span> <span class="s1">&#39;report_nm&#39;</span><span class="p">,</span> <span class="s1">&#39;flr_nm&#39;</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">[:]:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">[:]:</span>
<span class="c1">#             print(tag.find(element).text)</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">element</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">element</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
           
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>
        
    <span class="c1"># if corp_code == &#39;00301477&#39;:</span>
    <span class="c1">#     print(rows)</span>
    
    <span class="n">del_mode</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># 기재정정시 이전보고서 삭제 목적</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rows</span><span class="p">[:]):</span>
        <span class="c1"># 보고서명에 [첨부추가], [첨부정정]이 포함된 경우를 제외 </span>
        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;report_nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;첨부&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>                        
            <span class="n">rows</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="k">continue</span>       
        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;report_nm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;기재정정&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">del_mode</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">continue</span>
        
        <span class="k">if</span> <span class="n">del_mode</span><span class="p">:</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
            <span class="n">del_mode</span> <span class="o">=</span> <span class="kc">False</span>   
    
    <span class="c1"># if len(rows) &gt; 0: </span>
    <span class="c1">#     print(rows)</span>
                
    <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 실제 로직</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s1">&#39;select * from COMPANY&#39;</span><span class="p">)</span>

<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">,</span><span class="s1">&#39;corp_cls&#39;</span><span class="p">,</span><span class="s1">&#39;fas&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;acc_mt&#39;</span><span class="p">,</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">,</span><span class="s1">&#39;report_nm&#39;</span><span class="p">,</span><span class="s1">&#39;flr_nm&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">get_rcept_no</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">temp</span><span class="p">:</span>                
        <span class="n">rcept_no</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">]</span>
        <span class="n">report_nm</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;report_nm&#39;</span><span class="p">]</span>      
    
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;corp_code&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">],</span> <span class="s1">&#39;corp_cls&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;corp_cls&#39;</span><span class="p">],</span> <span class="s1">&#39;fas&#39;</span><span class="p">:</span><span class="s1">&#39;GAAP&#39;</span><span class="p">,</span> \
                     <span class="s1">&#39;year&#39;</span><span class="p">:</span><span class="n">report_nm</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span><span class="n">report_nm</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;acc_mt&#39;</span><span class="p">:</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;acc_mt&#39;</span><span class="p">],</span> \
                       <span class="s1">&#39;rcept_no&#39;</span><span class="p">:</span><span class="n">rcept_no</span><span class="p">,</span> <span class="s1">&#39;report_nm&#39;</span><span class="p">:</span><span class="n">report_nm</span><span class="p">,</span> <span class="s1">&#39;flr_nm&#39;</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="s1">&#39;flr_nm&#39;</span><span class="p">]})</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="c1"># print(df)</span>
<span class="n">save_to_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;REPORT&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="quiz-3">
<h1>[Quiz 3]<a class="headerlink" href="#quiz-3" title="Permalink to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>오픈다트 사이트에 접속하여 본인의 계정으로 호출한 총 호출건수와 서비스별 호출건수를 알아보세요.</p></li>
<li><p>자신의 API key 호출이 정상적으로 작동되고 있는지 테스트하는 코드를 작성해 보세요. (원문다운로드(document.xml) 호출과 농심켈로그 2022년 감사보고서 접수번호(rcept_no) 이용)</p></li>
<li><p>COMPANY 테이블 중 아성다이소와 토요코인 데이터를 pandas 데이터프레임으로 로딩하여 화면에 출력하는 코드를 작성하세요.
select_query(“select * from COMPANY where corp_code in (‘’, ‘’)”)</p></li>
</ol>
</section>
<section id="fs">
<h1>5. 감사보고서 파싱하여 저장(FS)<a class="headerlink" href="#fs" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># notepad++ 설치 필요</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://opendart.fss.or.kr/api/document.xml?crtfc_key=45688185cb834c3c13d22ba42a1ba654ad30e628&amp;rcept_no=20160404001388</span>

<span class="c1"># 감사보고서 HTML 리턴 함수</span>
<span class="k">def</span> <span class="nf">get_audit_soup</span><span class="p">(</span><span class="n">rcept_no</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">requests</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
    <span class="kn">from</span> <span class="nn">zipfile</span> <span class="kn">import</span> <span class="n">ZipFile</span>
    <span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
    <span class="kn">import</span> <span class="nn">warnings</span>
    
    <span class="c1"># 경고메세지 끄기</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1"># 다시 출력하게 하기</span>
    <span class="c1"># warnings.filterwarnings(action=&#39;default&#39;)</span>

    <span class="c1"># OpenDART에서 Zipfile 받아와 객체에 저장하기       </span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;https://opendart.fss.or.kr/api/document.xml&#39;</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;crtfc_key&#39;</span><span class="p">:</span><span class="n">api_key</span><span class="p">,</span> <span class="s1">&#39;rcept_no&#39;</span><span class="p">:</span><span class="n">rcept_no</span><span class="p">})</span>
    
    <span class="n">zipfile_bytes</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">content</span>
    <span class="n">zipfile_obj</span> <span class="o">=</span> <span class="n">ZipFile</span><span class="p">(</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">zipfile_bytes</span><span class="p">))</span>

    <span class="c1"># 압축을 풀어서 XML File을 string으로 담기</span>
    <span class="n">xmlfile_objs</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">):</span> <span class="n">zipfile_obj</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">zipfile_obj</span><span class="o">.</span><span class="n">namelist</span><span class="p">()}</span>        
    <span class="n">xml_str</span> <span class="o">=</span> <span class="n">xmlfile_objs</span><span class="p">[</span><span class="n">rcept_no</span><span class="o">+</span><span class="s1">&#39;_00760.xml&#39;</span><span class="p">]</span> <span class="c1"># 00760: 감사보고서</span>
    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">xml_str</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">soup</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_amt</span><span class="p">(</span><span class="n">amt</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">re</span>    
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[0-9|\()]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">amt</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="c1"># join 함수는 매개변수로 들어온 리스트에 있는 요소 하나하나를 합쳐서 하나의 문자열로 바꾸어 반환</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;()&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_report</span><span class="p">(</span><span class="n">corp_code</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">acc_mt</span><span class="p">,</span> <span class="n">rcept_no</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="c1"># import requests</span>
    <span class="kn">import</span> <span class="nn">re</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">corp_code</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">rcept_no</span><span class="p">)</span>  
    <span class="n">soup</span> <span class="o">=</span> <span class="n">get_audit_soup</span><span class="p">(</span><span class="n">rcept_no</span><span class="p">)</span>

    <span class="c1"># acode가 숫자4자리 이상인 &lt;te&gt; 구문만 선택 (자본변동표를 제외시키기 위함)    </span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;te&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;acode&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[0-9]{4,}$&#39;</span><span class="p">)})</span>         
    <span class="c1"># paragraphs = soup.findAll(&#39;p&#39;)</span>
        
      
    <span class="c1"># 재무상태표, 손익계산서, 현금흐름표        </span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;acc_mt&#39;</span><span class="p">,</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">,</span><span class="s1">&#39;fas&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;acct_nm&#39;</span><span class="p">,</span><span class="s1">&#39;acct_cd&#39;</span><span class="p">,</span><span class="s1">&#39;acct_lev&#39;</span><span class="p">,</span><span class="s1">&#39;amt&#39;</span><span class="p">,</span><span class="s1">&#39;prev_amt&#39;</span><span class="p">]</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cols</span><span class="p">))]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
      
    <span class="n">prev_alevel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">prev_acct</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>        
    <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">corp_code</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>
    <span class="n">results</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">month</span>   
    <span class="n">results</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">acc_mt</span>   
    <span class="n">results</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">rcept_no</span>           
    <span class="n">results</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;GAAP&#39;</span> <span class="c1"># 일반기업회계기준</span>

    <span class="n">ALLOW_ACCT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출채권&#39;</span><span class="p">,</span><span class="s1">&#39;단기대여금&#39;</span><span class="p">,</span><span class="s1">&#39;미수금&#39;</span><span class="p">,</span><span class="s1">&#39;미수수익&#39;</span><span class="p">,</span><span class="s1">&#39;선급금&#39;</span><span class="p">,</span><span class="s1">&#39;장기대여금&#39;</span><span class="p">,</span><span class="s1">&#39;장기외상매출금&#39;</span><span class="p">,</span> <span class="s1">&#39;대출금&#39;</span><span class="p">]</span>
    <span class="n">DEP_ACCT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;건물&#39;</span><span class="p">,</span><span class="s1">&#39;시설장치&#39;</span><span class="p">,</span><span class="s1">&#39;기계장치&#39;</span><span class="p">,</span><span class="s1">&#39;차량운반구&#39;</span><span class="p">,</span><span class="s1">&#39;구축물&#39;</span><span class="p">,</span><span class="s1">&#39;의료장비&#39;</span><span class="p">,</span><span class="s1">&#39;공구와기구&#39;</span><span class="p">,</span><span class="s1">&#39;비품&#39;</span><span class="p">,</span><span class="s1">&#39;시설장치&#39;</span><span class="p">,</span><span class="s1">&#39;연구용장비&#39;</span><span class="p">,</span>\
                <span class="s1">&#39;연구용기자재&#39;</span><span class="p">,</span><span class="s1">&#39;금형&#39;</span><span class="p">,</span><span class="s1">&#39;기타의유형자산&#39;</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table-group&#39;</span><span class="p">,</span> <span class="n">aclass</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PBS-2:A&#39;</span><span class="p">,</span> <span class="s1">&#39;PIS-2:A&#39;</span><span class="p">,</span> <span class="s1">&#39;PCF-I:A&#39;</span><span class="p">]):</span> 

        <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;aclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PBS-2:A&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;BS&#39;</span>
        <span class="k">elif</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;aclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PIS-2:A&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;IS&#39;</span>
        <span class="k">elif</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;aclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PCF-I:A&#39;</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;CF&#39;</span>
        
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;te&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;acode&#39;</span><span class="p">:</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;^[0-9]{4,}$&#39;</span><span class="p">)}):</span>                               
               
            <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span><span class="p">:</span>
                
                <span class="n">idx</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>                    
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">[</span><span class="n">idx</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">text</span>
                
                <span class="n">idx</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;(주&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>                    
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>
                    
                <span class="n">idx</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;&lt;주&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">idx</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>                    
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:</span><span class="n">idx</span><span class="p">]</span>
                                                    
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(손실)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(증가)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(감소)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;[가-힣]+&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>            
                <span class="n">tmp</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="s1">&#39;계&#39;</span><span class="p">:</span> <span class="c1"># 재무제표상 소계를 낸 라인의 경우 스킵</span>
                    <span class="k">continue</span>
                
                <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="s1">&#39;대손충당금&#39;</span> <span class="ow">and</span> <span class="n">prev_acct</span> <span class="ow">in</span> <span class="n">ALLOW_ACCT</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">prev_acct</span><span class="o">+</span><span class="n">tmp</span>
                <span class="k">elif</span> <span class="n">tmp</span> <span class="o">==</span> <span class="s1">&#39;감가상각누계액&#39;</span> <span class="ow">and</span> <span class="n">prev_acct</span> <span class="ow">in</span> <span class="n">DEP_ACCT</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">prev_acct</span><span class="o">+</span><span class="n">tmp</span>

                <span class="n">results</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="n">results</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;acode&#39;</span><span class="p">]</span>
                <span class="n">results</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;alevel&#39;</span><span class="p">]</span>
                <span class="n">prev_alevel</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;alevel&#39;</span><span class="p">]</span>
                <span class="n">prev_acct</span> <span class="o">=</span> <span class="n">tmp</span>
            
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">table</span><span class="p">[</span><span class="s1">&#39;aclass&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;PBS-2:A&#39;</span><span class="p">:</span> <span class="c1"># 재무상태표</span>
                    <span class="k">if</span> <span class="n">prev_alevel</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                                
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                                    
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                
                        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;자산&#39;</span><span class="p">,</span> <span class="s1">&#39;부채&#39;</span><span class="p">,</span> <span class="s1">&#39;자본&#39;</span><span class="p">]:</span>
                            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>                                            
                        <span class="n">prev_alevel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                
                        <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;자산&#39;</span><span class="p">,</span> <span class="s1">&#39;부채&#39;</span><span class="p">,</span> <span class="s1">&#39;자본&#39;</span><span class="p">]:</span>
                            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>                            
                        <span class="n">prev_alevel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>             
                <span class="k">else</span><span class="p">:</span> <span class="c1"># 손익계산서(&#39;PIS-2:A&#39;), 현금흐름표(&#39;PCF-I:A&#39;)</span>
                    <span class="k">if</span> <span class="n">prev_alevel</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;2&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                                
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                                    
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="o">==</span> <span class="s1">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;4&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                
                        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>                                            
                        <span class="n">prev_alevel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">elif</span> <span class="n">prev_alevel</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="p">[</span><span class="s1">&#39;adelim&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;3&#39;</span><span class="p">:</span>
                        <span class="n">results</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">make_amt</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>                
                        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>                            
                        <span class="n">prev_alevel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>                
       
    <span class="n">df_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>    
    
    <span class="k">return</span> <span class="n">df_fs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 메인 코드</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s1">&#39;select * from REPORT&#39;</span><span class="p">)</span>

<span class="n">df_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">parse_report</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;acc_mt&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">tmp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>      
        <span class="n">df_fs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_fs</span><span class="p">,</span> <span class="n">tmp</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
<span class="n">save_to_table</span><span class="p">(</span><span class="n">df_fs</span><span class="p">,</span> <span class="s1">&#39;FS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>00108269 2022 12 20230320001108
00108269 2021 12 20220331000105
00108269 2020 12 20210330000796
00108269 2019 12 20200330003768
00108269 2018 12 20190402000409
00108269 2017 12 20180404000561
00108269 2016 12 20170404001467
00108269 2015 12 20160404001388
00108269 2014 12 20150331000318
00108269 2013 12 20140327000710
00301477 2022 12 20230330000644
00301477 2021 12 20220401000723
00301477 2020 12 20210507000611
00301477 2019 12 20200402001109
00301477 2018 12 20190410000818
00301477 2017 12 20180410001133
00301477 2016 12 20170410001945
00301477 2015 12 20160331002179
00301477 2014 12 20150402001543
00411835 2022 12 20230412000331
00411835 2021 12 20220413000618
00411835 2020 12 20210414000481
00411835 2019 12 20200410000894
00411835 2018 12 20190402002448
00411835 2017 12 20180413001734
00411835 2016 12 20170331000917
00411835 2015 12 20160411002284
00411835 2014 12 20150401001558
00411835 2013 12 20140410000887
00585583 2022 12 20230413000799
00585583 2021 12 20220422000783
00585583 2020 12 20210430000468
00585583 2019 12 20200408000303
00585583 2018 12 20190408002194
00585583 2017 12 20180514003162
00585583 2016 12 20170407002138
00585583 2015 12 20160407001698
00585583 2014 12 20150407002013
00585583 2013 12 20140411000362
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 주석공시 표준화와 XBRL</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">YouTubeVideo</span>
<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;XpMmVpplaU8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <iframe
            width="400"
            height="300"
            src="https://www.youtube.com/embed/XpMmVpplaU8"
            frameborder="0"
            allowfullscreen
            
        ></iframe>
        </div></div>
</div>
</section>
<section id="anls">
<h1>6. 재무분석 수행(ANLS)<a class="headerlink" href="#anls" title="Permalink to this heading">#</a></h1>
<p>(CFA/FRM Schweser 교재 참고)</p>
<p><img alt="image.png" src="attachment:ce2262c0-25be-4e68-9763-f4fee4582cc8.png" /></p>
<section id="beneish-m-score-1999-detect-financial-fraud">
<h2>재무제표 신뢰도(Beneish M-score, 1999) -&gt; detect financial fraud<a class="headerlink" href="#beneish-m-score-1999-detect-financial-fraud" title="Permalink to this heading">#</a></h2>
<p>Beneish’s M-Score is a mathematical model that uses eight financial ratios weighted by coefficients to identify whether a company has manipulated its profits. It was created by Professor Messod Beneish who published a paper in June 1999 called “The Detection of Earnings Manipulation”.</p>
<ul class="simple">
<li><p>Days Sales in Receivables Index (DSRI): 매출에서 매출채권이 차지하는 비중이 작년보다 늘어난 정도, 매출채권 과대계상</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\text{DSRI} = \dfrac{\text{Receivables}_t / \text{Sales}_t}{\text{Receivables}_{t-1} / \text{Sales}_{t-1}}\)</span></p></li>
</ul>
</li>
</ul>
<p>The days’ sales in accounts receivable can be calculated as follows: the number of days in the year (use 360 or 365) divided by the accounts receivable turnover ratio during a past year.</p>
<ul class="simple">
<li><p>Gross Margin Index (GMI): 매출 대비 매출총이익 비율이 올해 줄어든 정도, 매출원가 과대계상</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\text{GMI} = \dfrac{(\text{Sales}_{t-1} - \text{COGS}_{t-1}) / \text{Sales}_{t-1}}{ (\text{Sales}_t - \text{COGS}_t) / \text{Sales}_t}\)</span></p></li>
</ul>
</li>
</ul>
<p>When this ratio is greater than 1, the gross margin has deteriorated. A firm with declining margins is more likely to manipulate earnings.</p>
<ul class="simple">
<li><p>Asset Quality Index (AQI): 자산 중 공정가치를 의심할만한 자산들이 증가할 경우</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{AQI} = \dfrac{1 - (\text{Current Assets}_t + \text{PP&amp;E}_t + \text{Securities}_t) / \text{Total Assets}_t}{1 - (\text{Current Assets}_{t-1} + \text{PP&amp;E}_{t-1} + \text{Securities}_{t-1}) / \text{Total Assets}_{t-1}} \)</span></p></li>
</ul>
</li>
</ul>
<p>It indicates the amount of total assets that are less certain to be ultimately realized, identified as asset quality.</p>
<ul class="simple">
<li><p>Sales Growth Index (SGI): 매출이 꾸준히 성장하는 회사의 경우 그 성장세가 꺾였을때 어떻게든 그것을 감추려고 재무제표를 조작</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{SGI} = \dfrac{\text{Sales}_t}{\text{Sales}_{t-1}} \)</span></p></li>
</ul>
</li>
<li><p>Depreciation Index (DEPI): 갑자기 감가상각비가 줄었다면, 감가상각비 계산 가정을 조작하여 회사의 비용을 낮춘 조작일 수 있음</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{DEPI} = \dfrac{\text{Depreciation}_{t-1}/ (\text{PP&amp;E}_{t-1} + \text{Depreciation}_{t-1})}  {\text{Depreciation}_t / (\text{PP&amp;E}_t + \text{Depreciation}_t)} \)</span></p></li>
</ul>
</li>
<li><p>Sales General and Administrative Expenses Index (SGAI): 판관비의 비중이 늘어났다는 것은 그만큼 경영 및 마케팅이 비효율적</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{SGAI} = \dfrac{\text{SG&amp;A Expense}_t / \text{Sales}_t} {\text{SG&amp;A Expense}_{t-1} / \text{Sales}_{t-1}} \)</span></p></li>
</ul>
</li>
<li><p>Leverage Index (LVGI): 총 자산에 비해 부채가 클 수록 회계부정을 의심해야 한다</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{LVGI} = \dfrac{(\text{Current Liabilities}_t + \text{Total Long Term Debt}_t) / \text{Total Assets}_t} {(\text{Current Liabilities}_{t-1} + \text{Total Long Term Debt}_{t-1}) / \text{Total Assets}_{t-1}} \)</span></p></li>
</ul>
</li>
<li><p>Total Accruals to Total Assets (TATA): 총 자산에 비해 비현금이익의 비중이 클수록 회계부정을 의심해야 한다</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{TATA} = \dfrac{\text{Income from Continuing Operations}_t - \text{Cash Flows from Operations}_t} {\text{Total Assets}_t} \)</span></p></li>
</ul>
</li>
</ul>
<p>The formula to calculate the M-score is:
$<span class="math notranslate nohighlight">\( \text{M-score} = −4.84 + 0.92 \text{DSRI} + 0.528 \text{GMI} + 0.404 \text{AQI} + 0.892 \text{SGI} + 0.115 \text{DEPI} − 0.172 \text{SGAI} − 0.327 \text{LVGI} + 4.697 \text{TATA} \)</span>$</p>
</section>
<section id="financial-ratios">
<h2>Financial Ratios<a class="headerlink" href="#financial-ratios" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>activity ratios</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{total asset turnover} = \dfrac{\text{revenue}} {\text{average total assets}} \)</span></p></li>
</ul>
</li>
<li><p>liquidity ratios</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{current ratio} = \dfrac{\text{current assets}} {\text{current liabilites}} \)</span></p></li>
</ul>
</li>
<li><p>solvency ratios</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{debt-to-equity} = \dfrac{\text{total debt}} {\text{total sharehoilders' equity}} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{financial leverage} = \dfrac{\text{average total assets}} {\text{average total equity}} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{interest coverage} = \dfrac{\text{EBIT}} {\text{interest payments}} \)</span></p></li>
</ul>
</li>
<li><p>profitability ratios</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{net profit margin} = \dfrac{\text{net income}} {\text{revenue}} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{gross profit margin} = \dfrac{\text{gross profit}} {\text{revenue}} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{operating profit margin} = \dfrac{\text{operating income}} {\text{revenue}} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{return on equity} = \dfrac{\text{net income}} {\text{average total equity}} \)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="free-cash-flow">
<h2>Free Cash Flow<a class="headerlink" href="#free-cash-flow" title="Permalink to this heading">#</a></h2>
<p><img alt="image.png" src="attachment:b74e2d31-6033-456d-ac0f-751b0516ba86.png" /></p>
<ul class="simple">
<li><p>Free Cash Flow to the Firm: unlevered FCF, 채권자와 주주 몫</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{FCFF}_1 = \text{[EBIT×(1-tax rate)] + depreciation - working capital investment - fixed capital investment}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{FCFF}_2 = \text{[EBITDA×(1-tax rate)] + depreciation×tax rate - working capital investment - fixed capital investment}\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{FCFF}_3 = \text{cash flow from operations + [interest×(1-tax rate)] - fixed capital investment} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{FCFF}_4 = \text{net income + noncash charges - working capital investment + [interest×(1-tax rate)] - fixed capital investment} \)</span></p></li>
</ul>
</li>
<li><p>Free Cash Flow to Equity: levered FCF, 주주 몫</p>
<ul>
<li><p><span class="math notranslate nohighlight">\( \text{FCFE}_1 = \text{FCFF - [interest×(1-tax rate)] + net borrowing} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{FCFE}_2 = \text{cash flow from operations - fixed capital investment + net borrowing} \)</span></p></li>
<li><p><span class="math notranslate nohighlight">\( \text{FCFE}_3 = \text{net income + noncash charges - working captital investment - fixed capital investment  + net borrowing} \)</span></p></li>
</ul>
</li>
</ul>
</section>
<section id="altman-z-score-detect-corporate-failure">
<h2>부도와의 거리(Altman z-score) -&gt; detect corporate failure<a class="headerlink" href="#altman-z-score-detect-corporate-failure" title="Permalink to this heading">#</a></h2>
<p><img alt="image.png" src="attachment:ec0bbfbb-8a69-47ad-865a-6cced8ef9634.png" /></p>
<p><img alt="image.png" src="attachment:0fadfbc5-49ed-4f80-9936-4bc80b28d0b7.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">acct</span><span class="p">,</span> <span class="n">prev</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">acct</span><span class="p">:</span>   
        <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;당기순이익&#39;</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;당기순손실&#39;</span><span class="p">:</span> <span class="c1"># 당기순이익(손실)은 IS, CF 둘다 있기 때문에 하나만 선택</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;IS&#39;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;acct_nm&#39;</span><span class="p">]</span><span class="c1">#.replace(&#39; &#39;,&#39;&#39;)</span>
        
        <span class="k">if</span> <span class="n">prev</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">t</span><span class="o">==</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">prev_amt</span><span class="o">.</span><span class="n">values</span><span class="p">))</span> 
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">v</span>                
        <span class="k">else</span><span class="p">:</span>                
            <span class="n">v</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">t</span><span class="o">==</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">amt</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="n">v</span>

    <span class="k">return</span> <span class="n">val</span>
</pre></div>
</div>
</div>
</div>
<p><img alt="image.png" src="attachment:35d8ab6e-0f96-415b-bcac-5f07b61cb4e6.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df_report</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s1">&#39;select * from REPORT&#39;</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;month&#39;</span><span class="p">,</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">,</span>
        <span class="c1"># M-score</span>
        <span class="s1">&#39;dsri&#39;</span><span class="p">,</span> <span class="s1">&#39;gmi&#39;</span><span class="p">,</span> <span class="s1">&#39;aqi&#39;</span><span class="p">,</span> <span class="s1">&#39;sgi&#39;</span><span class="p">,</span> <span class="s1">&#39;depi&#39;</span><span class="p">,</span> <span class="s1">&#39;sgai&#39;</span><span class="p">,</span> <span class="s1">&#39;lvgi&#39;</span><span class="p">,</span> <span class="s1">&#39;tata&#39;</span><span class="p">,</span> <span class="s1">&#39;m_score&#39;</span><span class="p">,</span>
        <span class="c1"># activity ratios</span>
        <span class="s1">&#39;total_asset_turnover&#39;</span><span class="p">,</span> 
        <span class="c1"># liquidity ratios</span>
        <span class="s1">&#39;current_ratio&#39;</span><span class="p">,</span> 
        <span class="c1"># solvency ratios</span>
        <span class="s1">&#39;debt_to_equity&#39;</span><span class="p">,</span> <span class="s1">&#39;financial_leverage&#39;</span><span class="p">,</span> <span class="s1">&#39;interest_coverage&#39;</span><span class="p">,</span>  
        <span class="c1"># profitability ratios</span>
        <span class="s1">&#39;net_profit_margin&#39;</span><span class="p">,</span> <span class="s1">&#39;gross_profit_margin&#39;</span><span class="p">,</span> <span class="s1">&#39;operating_profit_margin&#39;</span><span class="p">,</span> <span class="s1">&#39;return_on_equity&#39;</span><span class="p">,</span>
        <span class="c1"># FCF</span>
        <span class="s1">&#39;ebit&#39;</span><span class="p">,</span> <span class="s1">&#39;ebitda&#39;</span><span class="p">,</span> <span class="s1">&#39;fcff&#39;</span><span class="p">,</span> <span class="s1">&#39;fcfe&#39;</span><span class="p">,</span>
        <span class="c1"># z-score</span>
        <span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="s1">&#39;x3&#39;</span><span class="p">,</span> <span class="s1">&#39;x4&#39;</span><span class="p">,</span> <span class="s1">&#39;x5&#39;</span><span class="p">,</span> <span class="s1">&#39;z_score&#39;</span><span class="p">]</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">SALES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출액&#39;</span><span class="p">,</span><span class="s1">&#39;수익(매출액)&#39;</span><span class="p">,</span><span class="s1">&#39;영업수익&#39;</span><span class="p">]</span>
<span class="n">RECEIVABLES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출채권&#39;</span><span class="p">,</span><span class="s1">&#39;매출채권및기타채권&#39;</span><span class="p">,</span><span class="s1">&#39;분양미수금&#39;</span><span class="p">]</span>
<span class="n">PPE</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;유형자산&#39;</span><span class="p">,</span><span class="s1">&#39;무형자산&#39;</span><span class="p">]</span>
<span class="n">CGS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출원가&#39;</span><span class="p">,</span><span class="s1">&#39;매출원가액&#39;</span><span class="p">]</span>
<span class="n">SGA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;판매관리비&#39;</span><span class="p">,</span><span class="s1">&#39;판매비와관리비&#39;</span><span class="p">,</span><span class="s1">&#39;영업비용&#39;</span><span class="p">]</span>
<span class="n">DNA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;감가상각비&#39;</span><span class="p">,</span> <span class="s1">&#39;감가상각액&#39;</span><span class="p">,</span> <span class="s1">&#39;무형자산상각비&#39;</span><span class="p">,</span><span class="s1">&#39;무형자산상각액&#39;</span><span class="p">]</span>
<span class="c1"># NON_CASH_CHARGE = DNA + [&#39;대손충당금&#39;]</span>
<span class="n">TAX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;법인세&#39;</span><span class="p">,</span><span class="s1">&#39;법인세비용&#39;</span><span class="p">]</span>
<span class="n">NET_INCOME</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;당기순이익&#39;</span><span class="p">]</span>
<span class="n">NET_LOSS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;당기순손실&#39;</span><span class="p">]</span>
<span class="n">BORROWING</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;차입금&#39;</span><span class="p">,</span><span class="s1">&#39;장기차입금&#39;</span><span class="p">,</span><span class="s1">&#39;단기차입금&#39;</span><span class="p">,</span><span class="s1">&#39;유동성장기부채&#39;</span><span class="p">]</span>
<span class="n">BORROWED</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;대여금&#39;</span><span class="p">,</span><span class="s1">&#39;단기대여금&#39;</span><span class="p">,</span><span class="s1">&#39;장기대여금&#39;</span><span class="p">]</span>
<span class="n">INT_COST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;이자비용&#39;</span><span class="p">,</span><span class="s1">&#39;금융비용&#39;</span><span class="p">]</span>
<span class="n">EBT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;법인세차감전순이익&#39;</span><span class="p">,</span><span class="s1">&#39;법인세비용차감전순이익&#39;</span><span class="p">]</span>
<span class="n">FCINV</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;건물의취득&#39;</span><span class="p">,</span><span class="s1">&#39;기계장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;차량운반구의취득&#39;</span><span class="p">,</span><span class="s1">&#39;의료장비의취득&#39;</span><span class="p">,</span><span class="s1">&#39;비품의취득&#39;</span><span class="p">,</span><span class="s1">&#39;시설장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;건설중인자산의취득&#39;</span><span class="p">]</span> 

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_report</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># print(r[&#39;corp_code&#39;], r[&#39;year&#39;], r[&#39;month&#39;], r[&#39;rcept_no&#39;])    </span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select * from FS where corp_code=&#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39; and year=&#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39; </span><span class="se">\</span>
<span class="s2">            and month=&#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>      
        <span class="n">corp_code</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>
        <span class="n">rcept_no</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;rcept_no&#39;</span><span class="p">]</span>
    <span class="c1">#        </span>
    <span class="c1">#     Beneish M-score</span>
    <span class="c1"># </span>
    <span class="k">try</span><span class="p">:</span> <span class="c1"># Days Sales in Receivables Index</span>
        <span class="n">dsri</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">RECEIVABLES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">RECEIVABLES</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">dsri</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">dsri</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">dsri</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Gross Margin Index</span>
        <span class="n">gmi</span> <span class="o">=</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">CGS</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> \
            <span class="o">/</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">CGS</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">gmi</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">gmi</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">gmi</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>         

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Asset Quality Index</span>
        <span class="n">aqi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">PPE</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)))</span> \
            <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">PPE</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)))</span>        
    <span class="k">except</span><span class="p">:</span> <span class="n">aqi</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">aqi</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">aqi</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Sales Growth Index</span>
        <span class="n">sgi</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">sgi</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">sgi</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sgi</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Depreciation Index</span>
        <span class="n">depi</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">PPE</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">0</span><span class="p">)))</span> \
            <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">PPE</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">depi</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">depi</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">depi</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>  

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Sales General and Administrative Expenses Index</span>
        <span class="n">sgai</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SGA</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SGA</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">sgai</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">sgai</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sgai</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Leverage Index        </span>
        <span class="n">lvgi</span> <span class="o">=</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;비유동부채&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;매입채무&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span> \
            <span class="o">/</span> <span class="p">((</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;비유동부채&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;매입채무&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">lvgi</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">lvgi</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">lvgi</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Total Accruals to Total Assets</span>
        <span class="n">tata</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">NET_INCOME</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">NET_LOSS</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업활동으로인한현금흐름&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span> \
            <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">tata</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">tata</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tata</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span> <span class="c1"># Manipulation score</span>
         <span class="n">m_score</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.84</span><span class="o">+</span><span class="mf">0.92</span><span class="o">*</span><span class="n">dsri</span><span class="o">+</span><span class="mf">0.528</span><span class="o">*</span><span class="n">gmi</span><span class="o">+</span><span class="mf">0.404</span><span class="o">*</span><span class="n">aqi</span><span class="o">+</span><span class="mf">0.892</span><span class="o">*</span><span class="n">sgi</span><span class="o">+</span><span class="mf">0.115</span><span class="o">*</span><span class="n">depi</span><span class="o">-</span><span class="mf">0.172</span><span class="o">*</span><span class="n">sgai</span><span class="o">-</span><span class="mf">0.327</span><span class="o">*</span><span class="n">lvgi</span><span class="o">+</span><span class="mf">4.697</span><span class="o">*</span><span class="n">tata</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">m_score</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">m_score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">m_score</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    
    <span class="c1"># </span>
    <span class="c1">#     financial ratios</span>
    <span class="c1"># </span>
    
    <span class="c1"># activity ratios    </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">total_asset_turnover</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">total_asset_turnover</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">total_asset_turnover</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">total_asset_turnover</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   

    <span class="c1"># liquidity ratios</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_ratio</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">current_ratio</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="k">else</span><span class="p">:</span> <span class="n">current_ratio</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">current_ratio</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   

    <span class="c1"># solvency ratios</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">debt_to_equity</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;부채총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">debt_to_equity</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">debt_to_equity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">debt_to_equity</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">financial_leverage</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span> \
        <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">financial_leverage</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">financial_leverage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">financial_leverage</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span>
        <span class="n">interest_coverage</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">EBT</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">INT_COST</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">INT_COST</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">interest_coverage</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">interest_coverage</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">interest_coverage</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    
    
    <span class="c1"># profitability ratios</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">net_profit_margin</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">NET_INCOME</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">net_profit_margin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">net_profit_margin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">net_profit_margin</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span>
        <span class="n">gross_profit_margin</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">NET_INCOME</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">gross_profit_margin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">gross_profit_margin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">gross_profit_margin</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    

    <span class="k">try</span><span class="p">:</span>
        <span class="n">operating_profit_margin</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">operating_profit_margin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">operating_profit_margin</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">operating_profit_margin</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>     
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">return_on_equity</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">NET_INCOME</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="o">+</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">return_on_equity</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">return_on_equity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">return_on_equity</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>     
    <span class="c1">#         </span>
    <span class="c1">#     free cash flow</span>
    <span class="c1"># </span>
    <span class="k">if</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">200000000</span><span class="p">:</span> <span class="c1"># 2억원 미만       </span>
        <span class="n">tax_rate</span> <span class="o">=</span> <span class="mf">0.10</span>
    <span class="k">elif</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">20000000000</span><span class="p">:</span> <span class="c1"># 2억원 - 200억원</span>
        <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">-</span> <span class="mi">20000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">300000000000</span><span class="p">:</span> <span class="c1"># 200억원 - 3000억원</span>
        <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.22</span> <span class="o">-</span> <span class="mi">420000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">300000000000</span><span class="p">:</span> <span class="c1"># 3000억원 이상</span>
        <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mi">9420000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>        

    <span class="n">tax_rate</span> <span class="o">=</span> <span class="n">tax_rate</span> <span class="o">*</span> <span class="mf">1.1</span> <span class="c1"># 지방소득세 10% 가산</span>

    <span class="n">fcinv</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">FCINV</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">wcinv</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">net_borrowing</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">BORROWING</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">BORROWED</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">BORROWING</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">BORROWED</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="n">ebit</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ebitda</span> <span class="o">=</span> <span class="n">ebit</span> <span class="o">+</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fcff</span> <span class="o">=</span> <span class="n">ebit</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax_rate</span><span class="p">)</span> <span class="o">+</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">fcinv</span> <span class="o">-</span> <span class="n">wcinv</span>
    <span class="c1"># FCFF2 = EBITDA*(1-tax_rate) + acct_val(df,dna,0)*tax_rate - FCInv - WCInv   </span>
    <span class="c1"># FCFF3 = acct_val(df,[&#39;영업활동으로인한현금흐름&#39;],0) + acct_val(df,int_cost, 0)*(1-tax_rate) - FCInv   </span>
    <span class="c1"># FCFF4 = acct_val(df,net_income,0) + acct_val(df,non_cash_charge,0) + acct_val(df,int_cost,0)*(1-tax_rate) - FCInv - WCInv   </span>

    <span class="n">fcfe</span> <span class="o">=</span> <span class="n">fcff</span> <span class="o">-</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">INT_COST</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax_rate</span><span class="p">)</span> <span class="o">+</span> <span class="n">net_borrowing</span>    
    <span class="c1"># FCFE2 = acct_val(df,[&#39;영업활동으로인한현금흐름&#39;],0) - FCInv + net_borrowing</span>
    <span class="c1"># FCFE3 = acct_val(df,net_income,0) + acct_val(df,non_cash_charge,0) - FCInv - WCInv + net_borrowing</span>
    
    <span class="c1"># </span>
    <span class="c1">#     z-score</span>
    <span class="c1"># </span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">))</span><span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;이익잉여금&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">ebit</span> <span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
<span class="c1">#         X4 = market_val(r[&#39;corp_code&#39;], date.today())/ acct_val(df,[&#39;부채총계&#39;],0)</span>
        <span class="n">x4</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자본총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;부채총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x5</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;자산총계&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">z_score</span> <span class="o">=</span> <span class="mf">1.2</span><span class="o">*</span><span class="n">x1</span> <span class="o">+</span> <span class="mf">1.4</span><span class="o">*</span><span class="n">x2</span> <span class="o">+</span> <span class="mf">3.3</span><span class="o">*</span><span class="n">x3</span> <span class="o">+</span> <span class="mf">0.6</span><span class="o">*</span><span class="n">x4</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">x5</span>
    <span class="k">except</span><span class="p">:</span> <span class="n">z_score</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">x1</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x4</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">x5</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">x5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>    
        <span class="n">z_score</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">z_score</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>    
    
    <span class="c1"># results.extend([globals()[cols[i]] for i, _ in enumerate(cols)])</span>
    <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">globals</span><span class="p">()[</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)])</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>        
    
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">save_to_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;ANLS&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># M-score plotting</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corps</span><span class="p">):</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">corp</span><span class="p">][[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;m_score&#39;</span><span class="p">]]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
    <span class="c1"># print(df1)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;m_score&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">target_name</span><span class="p">(</span><span class="n">corp</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0eb9814e08cf9d476ca5dca00ac6f814033ad7552a5b3cc6a5959f2cf5e7ed22.png" src="_images/0eb9814e08cf9d476ca5dca00ac6f814033ad7552a5b3cc6a5959f2cf5e7ed22.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># activity ratios</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corps</span><span class="p">):</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">corp</span><span class="p">][[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;total_asset_turnover&#39;</span><span class="p">]]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
    <span class="c1"># print(df1)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;total_asset_turnover&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">target_name</span><span class="p">(</span><span class="n">corp</span><span class="p">))</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/199b70dba493d85216fe347ef5935f6cba7befe2ec3576eedd4a909cebe20940.png" src="_images/199b70dba493d85216fe347ef5935f6cba7befe2ec3576eedd4a909cebe20940.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># liquidity ratios</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corps</span><span class="p">):</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">corp</span><span class="p">][[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;current_ratio&#39;</span><span class="p">]]</span>
            <span class="c1"># &#39;current_ratio&#39;, &#39;quick_ratio&#39;, &#39;cash_ratio&#39;]]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
    <span class="c1"># print(df1)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;current_ratio&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">target_name</span><span class="p">(</span><span class="n">corp</span><span class="p">))</span>   
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/faa94f0f402c7e02f97e213600719b92f5e1c1e2392f4d8cd4a8b438b600b29f.png" src="_images/faa94f0f402c7e02f97e213600719b92f5e1c1e2392f4d8cd4a8b438b600b29f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># z-score</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">corp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">corps</span><span class="p">):</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">corp</span><span class="p">][[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;z_score&#39;</span><span class="p">]]</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
   
    <span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
    <span class="n">df1</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
    <span class="c1"># print(df1)</span>

    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;z_score&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">target_name</span><span class="p">(</span><span class="n">corp</span><span class="p">))</span>    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e2cd5b6b8f6d6464a0eb277449c2caf54c82428c2fe7e9d7867ca8e186a7a7e0.png" src="_images/e2cd5b6b8f6d6464a0eb277449c2caf54c82428c2fe7e9d7867ca8e186a7a7e0.png" />
</div>
</div>
</section>
</section>
<section id="dcf">
<h1>7. 기업가치평가 시뮬레이션(DCF)<a class="headerlink" href="#dcf" title="Permalink to this heading">#</a></h1>
<p>기업가치평가법의 3가지 대분류</p>
<ul class="simple">
<li><p>자산가치법(asset approach): 청산가치, 보통 자산/부채 실사를 통한 조정</p></li>
<li><p>수익가치법(income approach): 계속기업가치, Free cash flow(FCFF or FCFE) based DCF</p></li>
<li><p>상대가치법(market approach): EV/EBITDA, P/E, P/B, P/S 등</p></li>
</ul>
<p><img alt="dcf.png" src="attachment:37e47268-cbed-4618-9219-c81fbe42585a.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">acct</span><span class="p">):</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;acct_nm&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">acct</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">acct</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;acct_nm&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">acct</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>    
      
    <span class="c1"># print(df.loc[temp].groupby([&#39;year&#39;]).sum())</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">temp</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">amt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># DCF + Monte Carlo Simulation</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">BASE_YEAR</span> <span class="o">=</span> <span class="s1">&#39;2022&#39;</span> <span class="c1"># last year</span>

<span class="n">df_report</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select distinct corp_code, year, month from REPORT where month=acc_mt and year=&quot;</span> <span class="o">+</span> <span class="n">BASE_YEAR</span><span class="p">)</span>
<span class="c1"># df_report = df_report[(df_report[&#39;corp_code&#39;]==DAISO) | (df_report[&#39;corp_code&#39;]==TOYOKO)]</span>
<span class="c1"># df_report = df_report.query(&#39;corp_code == &quot;00301477&quot;&#39;)</span>
<span class="c1"># print(df_report)</span>
<span class="n">df_comp</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select * from COMPANY&quot;</span><span class="p">)</span>

<span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;base_sales&#39;</span><span class="p">,</span> <span class="s1">&#39;sales_growth&#39;</span><span class="p">,</span> <span class="s1">&#39;ebit_margin_mu&#39;</span><span class="p">,</span> <span class="s1">&#39;ebit_margin_std&#39;</span><span class="p">,</span>
        <span class="s1">&#39;depr_percent_mu&#39;</span><span class="p">,</span> <span class="s1">&#39;depr_percent_std&#39;</span><span class="p">,</span> <span class="s1">&#39;nwc_percent_mu&#39;</span><span class="p">,</span> <span class="s1">&#39;nwc_percent_std&#39;</span><span class="p">,</span> <span class="s1">&#39;capex_percent_mu&#39;</span><span class="p">,</span> <span class="s1">&#39;capex_percent_std&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tax_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;wacc&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">]</span>  
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">SALES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출액&#39;</span><span class="p">,</span><span class="s1">&#39;영업수익&#39;</span><span class="p">]</span>
<span class="n">DNA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;감가상각비&#39;</span><span class="p">,</span> <span class="s1">&#39;감가상각액&#39;</span><span class="p">,</span> <span class="s1">&#39;무형자산상각액&#39;</span><span class="p">]</span>
<span class="n">NON_CASH_CHARGE</span> <span class="o">=</span> <span class="n">DNA</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;대손충당금&#39;</span><span class="p">]</span>
<span class="n">TAX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;법인세&#39;</span><span class="p">,</span><span class="s1">&#39;법인세비용&#39;</span><span class="p">]</span>
<span class="n">CAPEX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;유형자산의취득&#39;</span><span class="p">,</span><span class="s1">&#39;기계장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;토지의취득&#39;</span><span class="p">,</span><span class="s1">&#39;건물의취득&#39;</span><span class="p">,</span><span class="s1">&#39;차량운반구의취득&#39;</span><span class="p">,</span><span class="s1">&#39;의료장비의취득&#39;</span><span class="p">,</span><span class="s1">&#39;비품의취득&#39;</span><span class="p">,</span> \
         <span class="s1">&#39;시설장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;건설중인자산의취득&#39;</span><span class="p">,</span><span class="s1">&#39;상표권의취득&#39;</span><span class="p">]</span>

<span class="n">iterations</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">df_report</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>    
    
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
       
    <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">])</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select * from FS where corp_code=&#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39; and year &lt;= &#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39; </span><span class="se">\</span>
<span class="s2">            and month=&#39;&quot;</span><span class="o">+</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># print(df)</span>
       
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">corp_code</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;corp_code&#39;</span><span class="p">]</span>
        <span class="n">year</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span>
        <span class="n">month</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span>        
<span class="c1"># </span>
<span class="c1">#     get DCF value by Monte-Carlo simulation </span>
<span class="c1"># </span>
    <span class="n">base_sales</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">BASE_YEAR</span><span class="p">],</span> <span class="n">SALES</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">sales_growth</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()),</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span> <span class="c1"># 성숙기업 sales 안정화 반영</span>
    <span class="n">ebit_margin_mu</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">ebit_margin_std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">depr_percent_mu</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">)</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">depr_percent_std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">DNA</span><span class="p">)</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">nwc_percent_mu</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">]))</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">nwc_percent_std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">]))</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span>     
    <span class="n">capex_percent_mu</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">CAPEX</span><span class="p">)</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span> <span class="c1"># 성숙기업 capex 안정화 반영</span>
    <span class="n">capex_percent_std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">CAPEX</span><span class="p">)</span><span class="o">/</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">SALES</span><span class="p">)),</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.75</span> <span class="c1"># 성숙기업 capex 안정화 반영</span>
    
    <span class="k">try</span><span class="p">:</span>    
        <span class="k">if</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">200000000</span><span class="p">:</span> <span class="c1"># 2억원 이하 10%(11%)        </span>
            <span class="n">tax_rate</span> <span class="o">=</span> <span class="mf">0.10</span>
        <span class="k">elif</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">20000000000</span><span class="p">:</span> <span class="c1"># 2억원 초과 200억원 이하 20%(22%)</span>
            <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.20</span> <span class="o">-</span> <span class="mi">20000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">300000000000</span><span class="p">:</span> <span class="c1"># 200억원 초과 3000억원 이하 22%(24.2%)</span>
            <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.22</span> <span class="o">-</span> <span class="mi">420000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">300000000000</span><span class="p">:</span> <span class="c1"># 3000억원 초과 25%(27.5%)</span>
            <span class="n">tax_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mi">9420000000</span><span class="p">)</span> <span class="o">/</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">df</span><span class="p">,[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>        
    <span class="k">except</span><span class="p">:</span> <span class="n">tax_rate</span> <span class="o">=</span> <span class="mf">0.20</span>
    <span class="k">else</span><span class="p">:</span> <span class="n">tax_rate</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">tax_rate</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>   
    
    <span class="n">tax_rate</span> <span class="o">=</span> <span class="n">tax_rate</span> <span class="o">*</span> <span class="mf">1.1</span> <span class="c1"># 지방소득세 10% 가산</span>
    <span class="c1"># (참고) 법인세 세율이 과세표준 구간별로 1%씩 인하(2023. 1. 1. 이후 개시하는 사업연도부터 적용)     </span>
        
    <span class="c1"># WACC 계산                         </span>
    <span class="n">r_e</span> <span class="o">=</span> <span class="mf">0.10</span>
    <span class="n">r_d</span> <span class="o">=</span> <span class="mf">0.06</span>
    <span class="n">wacc</span> <span class="o">=</span> <span class="n">r_d</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax_rate</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span> <span class="o">+</span> <span class="n">r_e</span> <span class="o">*</span> <span class="mf">0.5</span>       
    
    <span class="c1"># Create probability distributions</span>
    <span class="n">ebit_margin_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">ebit_margin_mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ebit_margin_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
    <span class="n">depr_percent_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">depr_percent_mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">depr_percent_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
    <span class="n">nwc_percent_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">nwc_percent_mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">nwc_percent_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>    
    <span class="n">capex_percent_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">capex_percent_mu</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">capex_percent_std</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">iterations</span><span class="p">)</span>
    
    <span class="c1"># Calculate DCF value for each set of random inputs</span>
    <span class="n">output_dist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">sales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>    
    
    <span class="c1">## MC simulation</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        
        <span class="n">sales</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_val</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">BASE_YEAR</span><span class="p">],</span> <span class="n">SALES</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">sales</span><span class="p">[</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">sales</span><span class="p">[</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">sales_growth</span><span class="p">)</span>

        <span class="n">ebit</span> <span class="o">=</span> <span class="n">sales</span> <span class="o">*</span> <span class="n">ebit_margin_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">depr</span> <span class="o">=</span> <span class="n">sales</span> <span class="o">*</span> <span class="n">depr_percent_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>        
        <span class="n">nwc</span> <span class="o">=</span> <span class="n">sales</span> <span class="o">*</span> <span class="n">nwc_percent_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">change_in_nwc</span> <span class="o">=</span> <span class="n">nwc</span> <span class="o">-</span> <span class="n">nwc</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">capex</span> <span class="o">=</span> <span class="n">sales</span> <span class="o">*</span> <span class="n">capex_percent_dist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     
        <span class="n">free_cash_flow</span> <span class="o">=</span> <span class="n">ebit</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">tax_rate</span><span class="p">)</span> <span class="o">+</span> <span class="n">depr</span> <span class="o">-</span> <span class="n">capex</span> <span class="o">-</span> <span class="n">change_in_nwc</span>
        
        <span class="c1"># DCF valuation</span>
        <span class="n">terminal_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">free_cash_flow</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.02</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">wacc</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">)</span>
        <span class="n">free_cash_flow</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">terminal_value</span>
        <span class="n">discount_factors</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">wacc</span><span class="p">))</span> <span class="o">**</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">)]</span>
        <span class="n">dcf_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">free_cash_flow</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">*</span> <span class="n">discount_factors</span><span class="p">)</span>
        <span class="n">output_dist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dcf_value</span><span class="p">)</span>
    
    <span class="n">mu</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">output_dist</span><span class="p">))</span>
    <span class="n">std</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">output_dist</span><span class="p">))</span>    
    
    <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">globals</span><span class="p">()[</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)])</span>      
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>
             
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
<span class="n">save_to_table</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;DCF&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>00108269 2022 12
00301477 2022 12
00411835 2022 12
00585583 2022 12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="s1">&#39;DCF.xlsx&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 확률밀도함수(KDE)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">13</span><span class="p">,</span><span class="mi">6</span><span class="p">)})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">output_dist</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Axes: ylabel=&#39;Density&#39;&gt;
</pre></div>
</div>
<img alt="_images/dcf7c79e8bdadd2f8c2c23621f0fc6a25ab1de8c61266f1357d0c162c2197730.png" src="_images/dcf7c79e8bdadd2f8c2c23621f0fc6a25ab1de8c61266f1357d0c162c2197730.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># pro-forma financial statement</span>
<span class="k">def</span> <span class="nf">make_fs_estimated</span><span class="p">(</span><span class="n">corp_code</span><span class="p">):</span>    
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    
    <span class="n">SALES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;매출액&#39;</span><span class="p">,</span><span class="s1">&#39;수익(매출액)&#39;</span><span class="p">,</span><span class="s1">&#39;영업수익&#39;</span><span class="p">]</span>
    <span class="n">EBIT</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;영업이익&#39;</span><span class="p">]</span>
    <span class="n">DNA</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;감가상각비&#39;</span><span class="p">,</span> <span class="s1">&#39;감가상각액&#39;</span><span class="p">,</span> <span class="s1">&#39;무형자산상각비&#39;</span><span class="p">,</span><span class="s1">&#39;무형자산상각액&#39;</span><span class="p">]</span>
    <span class="n">CAPEX</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;유형자산의취득&#39;</span><span class="p">,</span><span class="s1">&#39;기계장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;토지의취득&#39;</span><span class="p">,</span><span class="s1">&#39;건물의취득&#39;</span><span class="p">,</span><span class="s1">&#39;차량운반구의취득&#39;</span><span class="p">,</span><span class="s1">&#39;의료장비의취득&#39;</span><span class="p">,</span><span class="s1">&#39;비품의취득&#39;</span><span class="p">,</span> \
         <span class="s1">&#39;시설장치의취득&#39;</span><span class="p">,</span><span class="s1">&#39;건설중인자산의취득&#39;</span><span class="p">,</span><span class="s1">&#39;상표권의취득&#39;</span><span class="p">]</span>   

    <span class="n">dcf</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select * from DCF where corp_code=&#39;&quot;</span> <span class="o">+</span> <span class="n">corp_code</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>    
    <span class="n">fs</span> <span class="o">=</span> <span class="n">select_query</span><span class="p">(</span><span class="s2">&quot;select * from FS where corp_code=&#39;&quot;</span> <span class="o">+</span> <span class="n">corp_code</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span><span class="p">)</span>
    <span class="n">fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># print(dcf)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">SALES</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ebit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">EBIT</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">DNA</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nwc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,[</span><span class="s1">&#39;유동자산&#39;</span><span class="p">])</span><span class="o">-</span><span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,[</span><span class="s1">&#39;유동부채&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta_nwc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nwc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nwc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;capex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">acct_series</span><span class="p">(</span><span class="n">fs</span><span class="p">,</span> <span class="n">CAPEX</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># FCFF가 null이 나오는 것을 방지</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fcff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ebit&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;tax_rate&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;depr&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;delta_nwc&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;capex&#39;</span><span class="p">]</span>  
    <span class="c1"># dataframe.at[] -&gt; 하나의 스칼라 값에만 접근 가능, 속도향상</span>
      
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sales&#39;</span><span class="p">,</span><span class="s1">&#39;ebit&#39;</span><span class="p">,</span><span class="s1">&#39;depr&#39;</span><span class="p">,</span><span class="s1">&#39;nwc&#39;</span><span class="p">,</span><span class="s1">&#39;delta_nwc&#39;</span><span class="p">,</span><span class="s1">&#39;capex&#39;</span><span class="p">,</span><span class="s1">&#39;fcff&#39;</span><span class="p">]</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>    
    <span class="n">years</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========================&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ebit_margin_mu:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ebit_margin_mu&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depr_percent_mu:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;depr_percent_mu&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nwc_percent_mu:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nwc_percent_mu&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;capex_percent_mu:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;capex_percent_mu&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tax_rate:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;tax_rate&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wacc:&#39;</span><span class="p">,</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;wacc&#39;</span><span class="p">])</span>    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==========================&#39;</span><span class="p">)</span>
    
    <span class="n">prev_nwc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;nwc&#39;</span><span class="p">]</span> 
    <span class="c1"># print(prev_nwc)</span>
   
    <span class="c1"># 5개년 추정재무제표 생성</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>        
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>       

        <span class="n">years</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>        
        <span class="n">sales</span> <span class="o">=</span> <span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;base_sales&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;sales_growth&#39;</span><span class="p">])</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>        
        <span class="n">ebit</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ebit_margin_mu&#39;</span><span class="p">]</span>
        <span class="n">depr</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;depr_percent_mu&#39;</span><span class="p">]</span>
        <span class="n">nwc</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nwc_percent_mu&#39;</span><span class="p">]</span>
        <span class="n">delta_nwc</span> <span class="o">=</span> <span class="n">nwc</span> <span class="o">-</span> <span class="n">prev_nwc</span>
        <span class="n">capex</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;capex_percent_mu&#39;</span><span class="p">]</span>
        <span class="n">fcff</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;ebit_margin_mu&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;tax_rate&#39;</span><span class="p">])</span><span class="o">+</span><span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;depr_percent_mu&#39;</span><span class="p">]</span><span class="o">-</span>\
                       <span class="p">(</span><span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nwc_percent_mu&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">prev_nwc</span><span class="p">)</span> <span class="o">-</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;capex_percent_mu&#39;</span><span class="p">]</span>
        
        <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">sales</span><span class="p">,</span> <span class="n">ebit</span><span class="p">,</span> <span class="n">depr</span><span class="p">,</span> <span class="n">nwc</span><span class="p">,</span> <span class="n">delta_nwc</span><span class="p">,</span> <span class="n">capex</span><span class="p">,</span> <span class="n">fcff</span><span class="p">])</span>        
        <span class="c1"># results.extend([globals()[cols[i]] for i, _ in enumerate(cols)])  </span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">cols</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cols</span><span class="p">)})</span>
        
        <span class="n">prev_nwc</span> <span class="o">=</span> <span class="n">sales</span><span class="o">*</span><span class="n">dcf</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="s1">&#39;nwc_percent_mu&#39;</span><span class="p">]</span>        
            
    <span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>        
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:,.0f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>
<span class="c1"># pd.reset_option(&#39;display.float_format&#39;)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">make_fs_estimated</span><span class="p">(</span><span class="n">DAISO</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>==========================
ebit_margin_mu: 0.0677
depr_percent_mu: 0.064
nwc_percent_mu: -0.0001
capex_percent_mu: 0.03195
tax_rate: 0.24002
wacc: 0.0727994
==========================
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sales</th>
      <th>ebit</th>
      <th>depr</th>
      <th>nwc</th>
      <th>delta_nwc</th>
      <th>capex</th>
      <th>fcff</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2013</th>
      <td>746,512,962,345</td>
      <td>-2,560,687,788</td>
      <td>71,714,024,918</td>
      <td>-68,827,968,366</td>
      <td>0</td>
      <td>16,072,373,178</td>
      <td>53,695,580,235</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>890,045,251,414</td>
      <td>56,234,525,127</td>
      <td>62,114,394,486</td>
      <td>-75,741,791,837</td>
      <td>-6,913,823,471</td>
      <td>119,680,945,244</td>
      <td>-7,915,612,881</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>1,049,335,923,632</td>
      <td>84,299,372,762</td>
      <td>61,972,694,262</td>
      <td>-61,013,881,693</td>
      <td>14,727,910,144</td>
      <td>27,275,822,669</td>
      <td>84,034,798,761</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>1,305,583,763,484</td>
      <td>113,132,430,609</td>
      <td>79,228,041,452</td>
      <td>-52,486,881,439</td>
      <td>8,527,000,254</td>
      <td>48,287,212,794</td>
      <td>108,392,213,018</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>1,645,748,969,803</td>
      <td>149,798,699,791</td>
      <td>111,766,717,438</td>
      <td>-46,885,062,404</td>
      <td>5,601,819,035</td>
      <td>72,954,825,957</td>
      <td>147,054,088,313</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>1,978,571,938,775</td>
      <td>125,134,073,336</td>
      <td>147,525,146,842</td>
      <td>-66,704,893,598</td>
      <td>-19,819,831,194</td>
      <td>89,757,009,842</td>
      <td>172,687,361,248</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>2,236,209,030,402</td>
      <td>76,664,409,802</td>
      <td>181,750,364,588</td>
      <td>-19,464,789,345</td>
      <td>47,240,104,253</td>
      <td>169,231,767,071</td>
      <td>23,541,911,425</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>2,421,572,355,360</td>
      <td>173,757,214,226</td>
      <td>173,330,857,384</td>
      <td>92,606,180,016</td>
      <td>112,070,969,361</td>
      <td>46,660,960,181</td>
      <td>146,650,935,509</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>2,604,842,338,168</td>
      <td>283,834,599,253</td>
      <td>131,860,034,534</td>
      <td>343,332,632,745</td>
      <td>250,726,452,729</td>
      <td>18,250,084,951</td>
      <td>78,592,115,594</td>
    </tr>
    <tr>
      <th>2022</th>
      <td>2,945,760,870,659</td>
      <td>239,343,277,089</td>
      <td>105,754,750,002</td>
      <td>517,442,342,370</td>
      <td>174,109,709,625</td>
      <td>45,090,751,662</td>
      <td>68,450,392,437</td>
    </tr>
    <tr>
      <th>2023</th>
      <td>3,313,391,827,317</td>
      <td>224,316,626,709</td>
      <td>212,057,076,948</td>
      <td>-331,339,183</td>
      <td>-517,773,681,553</td>
      <td>105,862,868,883</td>
      <td>794,444,039,585</td>
    </tr>
    <tr>
      <th>2024</th>
      <td>3,726,903,127,366</td>
      <td>252,311,341,723</td>
      <td>238,521,800,151</td>
      <td>-372,690,313</td>
      <td>-41,351,130</td>
      <td>119,074,554,919</td>
      <td>311,240,169,845</td>
    </tr>
    <tr>
      <th>2025</th>
      <td>4,192,020,637,662</td>
      <td>283,799,797,170</td>
      <td>268,289,320,810</td>
      <td>-419,202,064</td>
      <td>-46,511,751</td>
      <td>133,935,059,373</td>
      <td>350,082,943,041</td>
    </tr>
    <tr>
      <th>2026</th>
      <td>4,715,184,813,242</td>
      <td>319,218,011,856</td>
      <td>301,771,828,047</td>
      <td>-471,518,481</td>
      <td>-52,316,418</td>
      <td>150,650,154,783</td>
      <td>393,773,294,333</td>
    </tr>
    <tr>
      <th>2027</th>
      <td>5,303,639,877,935</td>
      <td>359,056,419,736</td>
      <td>339,432,952,188</td>
      <td>-530,363,988</td>
      <td>-58,845,506</td>
      <td>169,451,294,100</td>
      <td>442,916,201,465</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
 
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">15</span><span class="p">,</span><span class="mi">8</span><span class="p">)})</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">:]:</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">col</span><span class="p">)</span>    
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="c1"># plt.ticklabel_format(style=&#39;plain&#39;, axis=&#39;y&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/53e95c754f8b5fb7bd07462e02a3ca6ed3c4a83d538d356c7b02df560d392a32.png" src="_images/53e95c754f8b5fb7bd07462e02a3ca6ed3c4a83d538d356c7b02df560d392a32.png" />
</div>
</div>
</section>
<section id="quiz-4">
<h1>[Quiz 4]<a class="headerlink" href="#quiz-4" title="Permalink to this heading">#</a></h1>
<ul class="simple">
<li><p>DuPont analysis</p></li>
</ul>
<p>ROE = net_profit_margin * total_asset_turnover * financial_leverage</p>
<p><img alt="image.png" src="attachment:04218c79-3b7f-42c2-8105-baf154362544.png" /></p>
<ol class="arabic simple">
<li><p>전체 3개 기업에 대하여 2022년 ROE를 듀퐁분석해서 마크다운 표로 나타내 보세요.</p></li>
</ol>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>기업명</p></th>
<th class="head"><p>ROE</p></th>
<th class="head"><p>순이익률</p></th>
<th class="head"><p>총자산회전율</p></th>
<th class="head"><p>재무레버리지</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>농심켈로그</p></td>
<td><p>0.4147</p></td>
<td><p>0.1237</p></td>
<td><p>1.8213</p></td>
<td><p>1.8409</p></td>
</tr>
<tr class="row-odd"><td><p>면사랑</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-even"><td><p>아성다이소</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p>토요코인</p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<ol class="arabic simple" start="2">
<li><p>위에서 구한 표를 seaborn.lineplot()으로 한 화면에 그래프로 표시해 보세요.</p></li>
</ol>
<p>select corp_name, return_on_equity, net_profit_margin, total_asset_turnover, financial_leverage from ANLS where year=’2022’</p>
<p>df = select_query()</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  <!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="exec_1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">0. 데이터 사이언스 툴킷 소개</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">0. 실습 프로젝트 개요</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dart-api-key">1. 오픈DART API Key</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#db">2. DB 입출력 함수 정의</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#company">3. 기업개황 테이블(COMPANY)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#report">4. 보고서 접수번호 테이블(REPORT)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiz-3">[Quiz 3]</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fs">5. 감사보고서 파싱하여 저장(FS)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#anls">6. 재무분석 수행(ANLS)</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beneish-m-score-1999-detect-financial-fraud">재무제표 신뢰도(Beneish M-score, 1999) -&gt; detect financial fraud</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#financial-ratios">Financial Ratios</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#free-cash-flow">Free Cash Flow</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#altman-z-score-detect-corporate-failure">부도와의 거리(Altman z-score) -&gt; detect corporate failure</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dcf">7. 기업가치평가 시뮬레이션(DCF)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quiz-4">[Quiz 4]</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By 김종남
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=927b94d3fcb96560df09"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=927b94d3fcb96560df09"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>